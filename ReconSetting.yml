---
id: '1'
name: Transaction Matches
dataSources:
  - id: sales
    predicate: date(transactionDate,'YYYY-MM-DD') >= '2021-04-01' and date(transactionDate,'YYYY-MM-DD')
      < '2022-04-01' order by transactionDate
    bucketFields:
      - entityId
  - id: tdsLedger
    predicate: date(transactionDate,'YYYY-MM-DD') >= '2021-04-01' and date(transactionDate,'YYYY-MM-DD')
      < '2022-04-01' order by transactionDate
    bucketFields:
      - entityId
  - id: 26as
    predicate: date(transactionDate,'YYYY-MM-DD') >= '2021-04-01' and date(transactionDate,'YYYY-MM-DD')
      < '2022-04-01' order by transactionDate
    bucketFields:
      - entityId
rulesets:
  - name: Field Checks
    type: FieldChecks
    rules:
      - id: tds_value_checks_on_sales
        expression: "#valueWithinTolerance(sales.tdsOnSales, 0.1 * sales.transactionAmount,
      1.0)"
        tagsWhenMatched:
          - CORRECT_TDS_ON_SALES
        tagsWhenNotMatched:
          - INCORRECT_TDS_ON_SALES
  - name: Total Level Matches
    type: TotalsComparison
    rules:
      - id: tds_totals_at_transactions_level_between_sales_and_tds_ledger
        expression: "#totalEqualsWithNumericTolerance('tds_totals_at_transactions_level_between_sales_and_tds_ledger',
      sales, tdsLedger, {'invoiceNo'}, {'invoiceNo'}, 'tdsOnSales', 'tds', 1.0)"
        tagsWhenMatched:
          - TRANSACTION_TOTALS_MATCHED_BETWEEN_SALES_AND_TDSLEDGER
        tagsWhenNotMatched:
          - TRANSACTION_TOTALS_UNMATCHED_BETWEEN_SALES_AND_TDSLEDGER
  - name: Transaction Level Matches
    type: EntryWiseOneToOneComparison
    terminateWhenTagsPresent:
      - TRANSACTION_TOTALS_MATCHED_BETWEEN_SALES_AND_TDSLEDGER
    rules:
      - id: tds_at_transactions_level_between_sales_and_tds_ledger
        expression: "#valueWithinTolerance(sales.tdsOnSales, tdsLedger.tds, 1.0) && sales.invoiceNo
      == tdsLedger.invoiceNo"
        expression1: "#multimatch('tds_at_transactions_level_between_sales_and_tds_ledger',
      sales, tdsLedger, {'invoiceNo'}, {'invoiceNo'}, 'tdsOnSales', 'tds', 1.0)"
        tagsWhenMatched:
          - TRANSACTIONS_MATCHED_BETWEEN_SALES_AND_TDSLEDGER
        tagsWhenNotMatched:
          - TRANSACTIONS_UNMATCHED_BETWEEN_SALES_AND_TDSLEDGER
